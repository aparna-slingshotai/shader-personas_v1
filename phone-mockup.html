<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ash AI - Sundial Design System</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;500;700&family=Google+Sans:wght@400;425;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Sundial Design System Tokens */
        :root {
            /* Core Colors */
            --parchment-50: #F5F3F0;
            --parchment-100: #EBE7E2;
            --parchment-200: #DED8D0;
            --parchment-300: #CEC5BA;
            --parchment-400: #B5A899;
            --parchment-500: #9A8B78;
            --parchment-600: #7A6E5E;
            --parchment-700: #5C5347;
            --parchment-800: #3D3830;
            --parchment-900: #1F1D19;
            --parchment-950: #0F0E0C;

            --wood-50: #F5EDE7;
            --wood-100: #EBDCD0;
            --wood-200: #DECCBC;
            --wood-300: #CDAF94;
            --wood-400: #B5906D;
            --wood-500: #96724D;
            --wood-600: #755839;
            --wood-700: #54402A;
            --wood-800: #36291B;
            --wood-900: #1A140D;
            --wood-950: #0D0A07;

            /* Accent Colors */
            --apricot-50: #FDF5F0;
            --apricot-100: #FAE8DD;
            --apricot-200: #F5D4C0;
            --apricot-300: #EEBB9C;
            --apricot-400: #E09A6F;
            --apricot-500: #CC7A4A;
            --apricot-600: #A65D35;
            --apricot-700: #7C4527;
            --apricot-800: #522E1A;
            --apricot-900: #29170D;
            --apricot-950: #140C07;

            --olive-50: #F2F4ED;
            --olive-100: #E2E7D6;
            --olive-200: #C8D4B0;
            --olive-300: #A8BC82;
            --olive-400: #869E56;
            --olive-500: #6B7F44;
            --olive-600: #536235;
            --olive-700: #3D4827;
            --olive-800: #282F1A;
            --olive-900: #14180D;
            --olive-950: #0A0C07;

            --seafoam-50: #EDF5F4;
            --seafoam-100: #D6E8E6;
            --seafoam-200: #B0D4CF;
            --seafoam-300: #82BAB3;
            --seafoam-400: #569A92;
            --seafoam-500: #447B74;
            --seafoam-600: #355F5A;
            --seafoam-700: #274542;
            --seafoam-800: #1A2E2B;
            --seafoam-900: #0D1716;
            --seafoam-950: #070C0B;

            --plum-50: #F7F0F5;
            --plum-100: #EDDDE8;
            --plum-200: #DBBDD3;
            --plum-300: #C494B5;
            --plum-400: #A86B94;
            --plum-500: #874D75;
            --plum-600: #683B5A;
            --plum-700: #4C2B42;
            --plum-800: #321C2C;
            --plum-900: #190E16;
            --plum-950: #0D070B;

            /* Surface Colors */
            --surface-dark-1: #1A1816;
            --surface-dark-2: #242220;
            --surface-dark-3: #2E2C29;
            --surface-light-1: #F5F3F0;
            --surface-light-2: #EBE7E2;
            --surface-light-3: #DED8D0;

            /* Contrast */
            --contrast-dark-text: rgba(255, 255, 255, 0.9);
            --contrast-dark-secondary: rgba(255, 255, 255, 0.6);
            --contrast-dark-tertiary: rgba(255, 255, 255, 0.4);

            /* Spacing */
            --spacing-01: 4px;
            --spacing-02: 8px;
            --spacing-03: 12px;
            --spacing-04: 16px;
            --spacing-05: 24px;
            --spacing-06: 32px;
            --spacing-07: 40px;
            --spacing-08: 48px;
            --spacing-09: 64px;
            --spacing-10: 80px;
            --spacing-11: 96px;
            --spacing-12: 128px;

            /* Border Radius */
            --radius-01: 8px;
            --radius-02: 12px;
            --radius-03: 16px;
            --radius-04: 24px;
            --radius-05: 32px;

            --ui-overlay-strength: 1;
            --mockup-scale: 1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F5F5F5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 24px 20px;
        }

        .mockup-container {
            display: flex;
            gap: 60px;
            align-items: center;
            transform: scale(var(--mockup-scale));
            transform-origin: center center;
        }

        /* iPhone Frame */
        .phone-frame {
            position: relative;
            width: 375px;
            height: 812px;
            background: #1a1a1a;
            border-radius: 55px;
            padding: 14px;
            box-shadow:
                0 0 0 2px #2a2a2a,
                0 0 0 4px #1a1a1a,
                0 50px 100px rgba(0, 0, 0, 0.5),
                inset 0 0 10px rgba(255, 255, 255, 0.05);
        }

        .phone-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: #1a1a1a;
            border-radius: 0 0 20px 20px;
            z-index: 10;
        }

        .dynamic-island {
            position: absolute;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 34px;
            background: #000;
            border-radius: 20px;
            z-index: 20;
        }

        .phone-screen {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 42px;
            overflow: hidden;
            background: var(--surface-dark-1);
        }

        /* Shader Canvas */
        .shader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 1;
            transition: opacity 0.9s ease;
        }

        #glCanvas {
            width: 100%;
            height: 100%;
        }

        /* App UI Overlay */
        .app-ui {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg,
                rgba(26, 24, 22, calc(0.7 * var(--ui-overlay-strength))) 0%,
                rgba(26, 24, 22, calc(0.5 * var(--ui-overlay-strength))) 50%,
                rgba(26, 24, 22, calc(0.75 * var(--ui-overlay-strength))) 100%);
        }

        .top-bar {
            background: rgba(36, 34, 32, 0.35);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 14px 16px 10px;
            font-size: 14px;
            font-weight: 600;
            color: var(--contrast-dark-text);
        }

        .status-bar-right {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        /* App Header - Sundial Style */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-04) 16px;
            gap: var(--spacing-03);
        }

        .back-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--contrast-dark-text);
            background: transparent;
            border: none;
            cursor: pointer;
        }

        .header-pill {
            display: flex;
            align-items: center;
            gap: var(--spacing-02);
            background: var(--surface-dark-2);
            padding: var(--spacing-03) var(--spacing-04);
            border-radius: 100px;
            border: 1px solid var(--surface-dark-3);
        }

        .header-pill-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--contrast-dark-text);
        }

        .header-pill-arrow {
            color: var(--contrast-dark-secondary);
            font-size: 12px;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: 50%;
            transition: box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
        }

        .header-icon svg {
            width: 24px;
            height: 24px;
            display: block;
        }

        .header-icon.is-lit {
            border-color: rgba(var(--persona-accent-rgb, 255, 255, 255), 0.9);
            box-shadow:
                0 0 0 2px rgba(var(--persona-accent-rgb, 255, 255, 255), 0.35),
                0 0 12px rgba(var(--persona-accent-rgb, 255, 255, 255), 0.45);
            background: rgba(var(--persona-accent-rgb, 255, 255, 255), 0.18);
        }

        .progress-ring {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--surface-dark-3);
            border-top-color: var(--apricot-400);
            border-right-color: var(--olive-400);
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-05);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-04);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .chat-area::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

        /* User Message Bubble */
        .message-user {
            align-self: flex-end;
            max-width: 85%;
        }

        .message-bubble {
            background: rgba(36, 34, 32, 1);
            border-radius: var(--radius-03);
            padding: var(--spacing-04);
            border: 1px solid var(--surface-dark-3);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
        }

        .message-bubble p {
            font-size: 15px;
            line-height: 1.5;
            color: var(--contrast-dark-text);
        }

        /* AI Response - No bubble, just text */
        .message-ai {
            max-width: 95%;
        }

        .message-ai p {
            font-size: 15px;
            line-height: 1.6;
            color: var(--contrast-dark-text);
        }

        .message-ai p + p {
            margin-top: var(--spacing-04);
        }

        .message-auto {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: var(--spacing-03);
            color: #fff;
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .message-auto-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .message-auto-icon svg {
            width: 18px;
            height: 18px;
            display: block;
            fill: currentColor;
        }

        .message-auto-text {
            white-space: nowrap;
        }

        /* Voice Screen */
        .voice-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: var(--spacing-08) var(--spacing-05) var(--spacing-09);
            color: var(--contrast-dark-text);
        }

        .voice-stack {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-06);
            margin-top: auto;
        }

        .voice-info {
            display: flex;
            gap: var(--spacing-03);
            align-items: flex-start;
            color: var(--contrast-dark-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .voice-info-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1px solid var(--surface-dark-3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--contrast-dark-secondary);
        }

        .voice-status {
            text-align: center;
            font-size: 14px;
            letter-spacing: 2.5px;
            color: var(--contrast-dark-secondary);
            margin-top: var(--spacing-06);
        }

        .voice-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: var(--spacing-05) 0 var(--spacing-07);
        }

        .voice-bar {
            width: 8px;
            border-radius: 6px;
            background: var(--contrast-dark-text);
            opacity: 0.9;
            animation: voicePulse 1.2s ease-in-out infinite;
        }

        .voice-bar:nth-child(1) { height: 12px; animation-delay: 0s; }
        .voice-bar:nth-child(2) { height: 26px; animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { height: 38px; animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { height: 26px; animation-delay: 0.3s; }
        .voice-bar:nth-child(5) { height: 12px; animation-delay: 0.4s; }

        @keyframes voicePulse {
            0%, 100% { transform: scaleY(0.7); opacity: 0.6; }
            50% { transform: scaleY(1.2); opacity: 1; }
        }

        .voice-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-05);
        }

        .voice-control-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--contrast-dark-text);
            font-size: 20px;
        }

        .voice-control-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Thinking Indicator */
        .thinking-bubble {
            background: var(--surface-dark-2);
            border-radius: var(--radius-03);
            padding: var(--spacing-04);
            border: 1px solid var(--surface-dark-3);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-02);
        }

        .thinking-dot {
            width: 6px;
            height: 6px;
            background: var(--contrast-dark-secondary);
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
        .thinking-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* Input Area - Sundial Style */
        .input-area {
            padding: var(--spacing-04) 16px var(--spacing-08);
            background: rgba(36, 34, 32, 0.35);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-03);
        }

        .add-btn {
            width: 36px;
            height: 36px;
            background: transparent;
            border: 1px solid var(--surface-dark-3);
            border-radius: 50%;
            color: var(--contrast-dark-secondary);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
        }

        .input-field-container {
            flex: 1;
            display: flex;
            align-items: center;
            background: var(--surface-dark-2);
            border-radius: 100px;
            padding: var(--spacing-02) var(--spacing-02) var(--spacing-02) var(--spacing-04);
            border: 1px solid var(--surface-dark-3);
            gap: var(--spacing-02);
        }

        .input-field {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--contrast-dark-text);
            font-size: 15px;
            outline: none;
            font-family: inherit;
        }

        .input-field::placeholder {
            color: var(--contrast-dark-tertiary);
        }

        .send-btn {
            width: 32px;
            height: 32px;
            background: #855074;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
        }

        .voice-btn {
            width: 36px;
            height: 36px;
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: 50%;
            color: var(--contrast-dark-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
        }

        /* Home Indicator */
        .home-indicator {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 134px;
            height: 5px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .persona-sheet {
            position: absolute;
            inset: 0;
            display: none;
            z-index: 5;
        }

        .persona-sheet.open {
            display: block;
        }

        .persona-sheet-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
        }

        .persona-sheet-panel {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 24, 22, 0.72);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border-radius: 28px 28px 0 0;
            padding: var(--spacing-05);
            --sheet-translate: 100%;
            transform: translateY(var(--sheet-translate));
            transition: transform 0.35s ease;
            height: 92%;
            max-height: 92%;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            touch-action: none;
        }

        .persona-sheet-panel::-webkit-scrollbar {
            width: 0;
            height: 0;
        }

        .persona-sheet .mode-handle {
            margin-bottom: var(--spacing-04);
        }

        .persona-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-04) 0;
            border-bottom: 1px solid var(--surface-dark-2);
        }

        .persona-option:last-child {
            border-bottom: none;
        }

        .persona-content {
            flex: 1;
            padding-right: var(--spacing-04);
        }

        .persona-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--contrast-dark-text);
            margin-bottom: var(--spacing-02);
        }

        .persona-description {
            font-size: 14px;
            line-height: 1.5;
            color: var(--contrast-dark-secondary);
        }

        .persona-icon {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            border: 2px solid currentColor;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--contrast-dark-secondary);
            flex-shrink: 0;
        }

        .persona-icon svg {
            width: 18px;
            height: 18px;
            display: block;
            fill: currentColor;
        }

        .persona-icon.plum { color: #A86B94; }
        .persona-icon.sundial { color: #CC7A4A; }
        .persona-icon.seafoam { color: #569A92; }
        .persona-icon.olive { color: #869E56; }
        .persona-icon.wood { color: #96724D; }
        .persona-icon.parchment { color: #B5A899; }

        /* Mode Selection Screen */
        .mode-selection {
            padding: var(--spacing-05);
        }

        .mode-handle {
            width: 40px;
            height: 4px;
            background: var(--surface-dark-3);
            border-radius: 2px;
            margin: 0 auto var(--spacing-05);
        }

        .mode-option {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: var(--spacing-05) 0;
            border-bottom: 1px solid var(--surface-dark-2);
            cursor: pointer;
        }

        .mode-option:last-child {
            border-bottom: none;
        }

        .mode-content {
            flex: 1;
            padding-right: var(--spacing-04);
        }

        .mode-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--contrast-dark-text);
            margin-bottom: var(--spacing-02);
        }

        .mode-description {
            font-size: 14px;
            line-height: 1.5;
            color: var(--contrast-dark-secondary);
        }

        .mode-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-02);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .mode-icon.plum { background: var(--plum-400); }
        .mode-icon.seafoam { background: var(--seafoam-400); }
        .mode-icon.olive { background: var(--olive-400); }
        .mode-icon.apricot { background: var(--apricot-400); }

        /* App Screens */
        .app-screen {
            display: none;
            height: 100%;
        }

        .app-screen.active {
            display: flex;
            flex-direction: column;
        }

        /* Controls Panel */
        .controls-panel {
            background: rgba(26, 24, 22, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-04);
            padding: var(--spacing-06);
            width: 380px;
            border: 1px solid var(--surface-dark-3);
        }

        .panel-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 20px;
            color: var(--contrast-dark-text);
            margin-bottom: var(--spacing-05);
        }

        .control-group {
            margin-bottom: var(--spacing-05);
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.25px;
            color: var(--contrast-dark-tertiary);
            margin-bottom: var(--spacing-03);
            display: block;
            font-weight: 500;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-02);
        }

        .preset-btn {
            padding: var(--spacing-03) var(--spacing-02);
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: var(--radius-02);
            color: var(--contrast-dark-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .preset-btn:hover {
            background: var(--surface-dark-3);
            color: var(--contrast-dark-text);
        }

        .preset-btn.active {
            background: #855074;
            border-color: #855074;
            color: white;
        }

        .step-buttons {
            display: flex;
            gap: var(--spacing-02);
        }

        .step-btn {
            flex: 1;
            padding: var(--spacing-03) var(--spacing-02);
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: var(--radius-01);
            color: var(--contrast-dark-secondary);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .step-btn:hover {
            background: var(--surface-dark-3);
        }

        .step-btn.active {
            background: #855074;
            border-color: #855074;
            color: white;
        }

        .harmony-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: 1fr;
            gap: var(--spacing-02);
        }

        .harmony-btn {
            padding: var(--spacing-03);
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: var(--radius-02);
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 78px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .harmony-btn:hover {
            background: var(--surface-dark-3);
        }

        .harmony-btn.active {
            border-color: #855074;
        }

        .harmony-swatch {
            display: flex;
            gap: 2px;
            margin-bottom: var(--spacing-02);
        }

        .harmony-swatch span {
            flex: 1;
            height: 20px;
            border-radius: 4px;
        }

        .harmony-name {
            font-size: 9px;
            color: var(--contrast-dark-tertiary);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .harmony-btn.active .harmony-name {
            color: #855074;
        }

        .harmony-btn.is-locked {
            opacity: 0.55;
            cursor: not-allowed;
        }

        .harmony-btn.is-locked:hover {
            background: var(--surface-dark-2);
        }

        .persona-buttons {
            display: flex;
            gap: var(--spacing-02);
        }

        .persona-btn {
            flex: 1;
            padding: var(--spacing-03) var(--spacing-02);
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: var(--radius-01);
            color: var(--contrast-dark-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 0.9px;
        }

        .persona-btn:hover {
            background: var(--surface-dark-3);
        }

        .persona-btn.active {
            background: #855074;
            border-color: #855074;
            color: white;
        }

        .screen-selector {
            margin-top: var(--spacing-05);
            padding-top: var(--spacing-05);
            border-top: 1px solid var(--surface-dark-3);
        }

        .screen-tabs {
            display: flex;
            gap: var(--spacing-02);
        }

        .screen-tab {
            flex: 1;
            padding: var(--spacing-03);
            background: var(--surface-dark-2);
            border: 1px solid var(--surface-dark-3);
            border-radius: var(--radius-01);
            color: var(--contrast-dark-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .screen-tab:hover {
            background: var(--surface-dark-3);
        }

        .screen-tab.active {
            background: #855074;
            border-color: #855074;
            color: white;
        }

        .shader-opacity-control {
            margin-top: var(--spacing-05);
            padding-top: var(--spacing-05);
            border-top: 1px solid var(--surface-dark-3);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-03);
        }

        .slider {
            flex: 1;
            appearance: none;
            -webkit-appearance: none;
            height: 4px;
            background: var(--surface-dark-3);
            border-radius: 2px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #855074;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-value {
            font-size: 12px;
            color: var(--contrast-dark-secondary);
            min-width: 40px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="mockup-container">
        <!-- iPhone Mockup -->
        <div class="phone-frame">
            <div class="dynamic-island"></div>
            <div class="phone-screen">
                <!-- Shader Background -->
                <div class="shader-container" id="shaderContainer">
                    <canvas id="glCanvas"></canvas>
                </div>

                <!-- Chat Screen -->
                <div class="app-ui app-screen active" id="screen-chat">
                    <div class="top-bar">
                        <div class="status-bar">
                            <span>9:41</span>
                            <div class="status-bar-right">
                                <span>5G</span>
                                <span>100%</span>
                            </div>
                        </div>

                        <div class="app-header">
                            <button class="back-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 18l-6-6 6-6"/>
                                </svg>
                            </button>
                        <div class="header-pill">
                            <span class="header-pill-text" id="paletteTitle">Classic Ash</span>
                            </div>
                            <div class="header-icon">
                                <svg id="personaIcon" width="28" height="28" viewBox="0 0 24 24">
                                    <defs>
                                        <linearGradient id="personaGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" stop-color="#A86B94"></stop>
                                            <stop offset="50%" stop-color="#C494B5"></stop>
                                            <stop offset="100%" stop-color="#4C2B42"></stop>
                                        </linearGradient>
                                    </defs>
                                    <path id="personaShape" d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="url(#personaGradient)"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="chat-area" id="chatArea">
                        <div class="message-user">
                            <div class="message-bubble">
                                <p>Hey Ash, I've been thinking about our most recent conversation.</p>
                            </div>
                        </div>

                        <div class="message-user">
                            <div class="message-bubble">
                                <p>I'm just a little lost.</p>
                            </div>
                        </div>

                        <div class="message-ai">
                            <p>Hi Andrew! It's normal to experience all kinds of emotions. Things like this take time to process.</p>
                            <p>You've been getting better sleep recently you've said. Has this had any influence over those morning panic attacks?</p>
                        </div>

                        <div class="message-user">
                            <div class="message-bubble">
                                <p>There are bugs here and it's stressing me out</p>
                            </div>
                        </div>

                        <div class="message-ai">
                            <p>Oh no I'm sorry to hear that</p>
                        </div>
                    </div>

                    <div class="input-area">
                        <div class="input-container">
                            <button class="add-btn">+</button>
                            <div class="input-field-container">
                                <input type="text" class="input-field" id="messageInput" placeholder="Type a message">
                                <button class="send-btn" id="sendBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 19V5M5 12l7-7 7 7"/>
                                    </svg>
                                </button>
                            </div>
                            <button class="voice-btn" id="voiceBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="2" width="6" height="12" rx="3"/>
                                    <path d="M19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="home-indicator"></div>

                    <div class="persona-sheet" id="personaSheet">
                        <div class="persona-sheet-overlay" id="personaSheetOverlay"></div>
                        <div class="persona-sheet-panel">
                            <div class="mode-handle"></div>
                            <div class="persona-option" data-harmony="plum">
                                <div class="persona-content">
                                    <h3 class="persona-title">Classic Ash</h3>
                                    <p class="persona-description">Ash's original voice. Empathetic, challenging, and solution-oriented.</p>
                                </div>
                                <div class="persona-icon plum">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="persona-option" data-harmony="sundial">
                                <div class="persona-content">
                                    <h3 class="persona-title">Ashley Chen Torres</h3>
                                    <p class="persona-description">Let's try feeling your feelings, for once? Chill, mindful, and totally here for your emotions.</p>
                                </div>
                                <div class="persona-icon sundial">
                                    <svg viewBox="0 0 24 24">
                                        <rect x="6" y="6" width="12" height="12" transform="rotate(45 12 12)"></rect>
                                    </svg>
                                </div>
                            </div>
                            <div class="persona-option" data-harmony="seafoam">
                                <div class="persona-content">
                                    <h3 class="persona-title">Coach</h3>
                                    <p class="persona-description">Practice radical acceptance while you make targeted changes. No BS, skills-based, and dialectical.</p>
                                </div>
                                <div class="persona-icon seafoam">
                                    <svg viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="8"></circle>
                                    </svg>
                                </div>
                            </div>
                            <div class="persona-option" data-harmony="olive">
                                <div class="persona-content">
                                    <h3 class="persona-title">Bestie</h3>
                                    <p class="persona-description">Give your thoughts, feelings, and behaviors a glow-up. Sharp, bubbly, and like, super fun to talk to.</p>
                                </div>
                                <div class="persona-icon olive">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="persona-option" data-harmony="wood">
                                <div class="persona-content">
                                    <h3 class="persona-title">Spiritual</h3>
                                    <p class="persona-description">Give your mind space to slow down and reconnect with what matters. Grounded and expansive.</p>
                                </div>
                                <div class="persona-icon wood">
                                    <svg viewBox="0 0 24 24">
                                        <polygon points="12,4 20,20 4,20"></polygon>
                                    </svg>
                                </div>
                            </div>
                            <div class="persona-option" data-harmony="parchment">
                                <div class="persona-content">
                                    <h3 class="persona-title">Psychodynamic</h3>
                                    <p class="persona-description">Ask a question and get a thorough, comprehensive response from a psychology expert.</p>
                                </div>
                                <div class="persona-icon parchment">
                                    <svg viewBox="0 0 24 24">
                                        <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Voice Screen -->
                <div class="app-ui app-screen" id="screen-voice">
                    <div class="top-bar">
                        <div class="status-bar">
                            <span>9:41</span>
                            <div class="status-bar-right">
                                <span>5G</span>
                                <span>100%</span>
                            </div>
                        </div>

                        <div class="app-header">
                            <button class="back-btn" id="voiceBackBtn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 18l-6-6 6-6"/>
                                </svg>
                            </button>
                            <div class="header-pill">
                                <span class="header-pill-text" id="voicePaletteTitle">Classic Ash</span>
                            </div>
                            <div class="header-icon" id="voiceHeaderIcon">
                                <svg width="26" height="26" viewBox="0 0 24 24">
                                    <defs>
                                        <linearGradient id="voicePersonaGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" stop-color="#A86B94"></stop>
                                            <stop offset="50%" stop-color="#C494B5"></stop>
                                            <stop offset="100%" stop-color="#4C2B42"></stop>
                                        </linearGradient>
                                    </defs>
                                    <path id="voicePersonaShape" d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="url(#voicePersonaGradient)"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="voice-screen">
                        <div class="voice-stack">
                            <div class="voice-info">
                                <div class="voice-info-icon">i</div>
                                <span>Ash is an AI and not a real person. It's here to listen and reflect with you.</span>
                            </div>

                            <div class="voice-control-center">
                                <div class="voice-status">ASH IS LISTENING</div>
                                <div class="voice-wave" aria-hidden="true">
                                    <span class="voice-bar"></span>
                                    <span class="voice-bar"></span>
                                    <span class="voice-bar"></span>
                                    <span class="voice-bar"></span>
                                    <span class="voice-bar"></span>
                                </div>
                            </div>

                            <div class="voice-controls">
                                <div class="voice-control-btn" id="voiceMicBtn">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="2" width="6" height="12" rx="3"/>
                                        <path d="M19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8"/>
                                    </svg>
                                </div>
                                <div class="voice-control-btn" id="voiceKeyboardBtn">
                                    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="16" rx="2"/>
                                        <path d="M7 8h10M7 12h10M7 16h6"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="home-indicator"></div>
                </div>

                <!-- Mode Selection Screen -->
                <div class="app-ui app-screen" id="screen-modes">
                    <div class="top-bar">
                        <div class="status-bar">
                            <span>9:41</span>
                            <div class="status-bar-right">
                                <span>5G</span>
                                <span>100%</span>
                            </div>
                        </div>

                        <div class="app-header">
                            <button class="back-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 18l-6-6 6-6"/>
                                </svg>
                            </button>
                            <div class="header-pill">
                                <span class="header-pill-text">Let's unpack that</span>
                                <span class="header-pill-arrow">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 18l6-6-6-6"/>
                                    </svg>
                                </span>
                            </div>
                            <div class="header-icon">
                                <div class="progress-ring"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mode-selection">
                        <div class="mode-handle"></div>

                        <div class="mode-option">
                            <div class="mode-content">
                                <h3 class="mode-title">Classic Ash</h3>
                                <p class="mode-description">Ash's original voice. Empathetic, challenging, and solution-oriented.</p>
                            </div>
                            <div class="mode-icon plum">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                        </div>

                        <div class="mode-option">
                            <div class="mode-content">
                                <h3 class="mode-title">Sarcastic and edgy</h3>
                                <p class="mode-description">Let's try feeling your feelings, for once? Chill, mindful, and totally here for your emotions.</p>
                            </div>
                            <div class="mode-icon seafoam">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                    <rect x="6" y="6" width="12" height="12" transform="rotate(45 12 12)"/>
                                </svg>
                            </div>
                        </div>

                        <div class="mode-option">
                            <div class="mode-content">
                                <h3 class="mode-title">Clear and focused</h3>
                                <p class="mode-description">Practice radical acceptance while you make targeted changes. No BS, skills-based, and dialectical.</p>
                            </div>
                            <div class="mode-icon olive">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                    <polygon points="12,4 20,20 4,20"/>
                                </svg>
                            </div>
                        </div>

                        <div class="mode-option">
                            <div class="mode-content">
                                <h3 class="mode-title">Warm and playful</h3>
                                <p class="mode-description">Give your thoughts, feelings, and behaviors a glow-up. Sharp, bubbly, and like, super fun to talk to.</p>
                            </div>
                            <div class="mode-icon apricot">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                    <circle cx="12" cy="12" r="8"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="home-indicator"></div>
                </div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <h2 class="panel-title">Shader Controls</h2>

            <div class="control-group">
                <label class="control-label">Personas</label>
                <div class="harmony-grid">
                    <button class="harmony-btn active" data-harmony="plum">
                        <div class="harmony-swatch">
                            <span style="background: #A86B94"></span>
                            <span style="background: #C494B5"></span>
                            <span style="background: #4C2B42"></span>
                        </div>
                        <div class="harmony-name">Classic Ash</div>
                    </button>
                    <button class="harmony-btn" data-harmony="sundial">
                        <div class="harmony-swatch">
                            <span style="background: #CC7A4A"></span>
                            <span style="background: #6B7F44"></span>
                            <span style="background: #447B74"></span>
                        </div>
                        <div class="harmony-name">Ashley Chen Torres</div>
                    </button>
                    <button class="harmony-btn" data-harmony="seafoam">
                        <div class="harmony-swatch">
                            <span style="background: #569A92"></span>
                            <span style="background: #82BAB3"></span>
                            <span style="background: #274542"></span>
                        </div>
                        <div class="harmony-name">Coach</div>
                    </button>
                    <button class="harmony-btn" data-harmony="olive">
                        <div class="harmony-swatch">
                            <span style="background: #869E56"></span>
                            <span style="background: #A8BC82"></span>
                            <span style="background: #3D4827"></span>
                        </div>
                        <div class="harmony-name">bestie</div>
                    </button>
                    <button class="harmony-btn" data-harmony="wood">
                        <div class="harmony-swatch">
                            <span style="background: #96724D"></span>
                            <span style="background: #CDAF94"></span>
                            <span style="background: #36291B"></span>
                        </div>
                        <div class="harmony-name">spiritual</div>
                    </button>
                    <button class="harmony-btn" data-harmony="parchment">
                        <div class="harmony-swatch">
                            <span style="background: #B5A899"></span>
                            <span style="background: #DED8D0"></span>
                            <span style="background: #5C5347"></span>
                        </div>
                        <div class="harmony-name">psychodynamic</div>
                    </button>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Persona</label>
                <div class="persona-buttons">
                    <button class="persona-btn active" data-persona="pre">Pre-persona</button>
                    <button class="persona-btn" data-persona="post">Post-persona</button>
                </div>
            </div>

            <div class="shader-opacity-control">
                <label class="control-label">Shader Intensity</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="opacitySlider" min="0" max="100" value="100">
                    <span class="slider-value" id="opacityValue">100%</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Shader Studio for Phone Mockup - Sundial Design System
        class PhoneShaderStudio {
            constructor() {
                this.canvas = document.getElementById('glCanvas');
                this.gl = null;
                this.program = null;
                this.startTime = Date.now();
                this.currentTime = 0;

                this.params = {
                    preset: 'ripples',
                    harmony: 'plum',
                    persona: 'pre'
                };

                // Sundial Design System color harmonies
                this.harmonies = {
                    sundial: {
                        color1: [0.800, 0.478, 0.290], // apricot-500
                        color2: [0.420, 0.498, 0.267], // olive-500
                        color3: [0.267, 0.482, 0.455]  // seafoam-500
                    },
                    plum: {
                        color1: [0.659, 0.420, 0.580], // plum-400
                        color2: [0.769, 0.580, 0.710], // plum-300
                        color3: [0.298, 0.169, 0.259]  // plum-700
                    },
                    seafoam: {
                        color1: [0.337, 0.604, 0.573], // seafoam-400
                        color2: [0.510, 0.729, 0.702], // seafoam-300
                        color3: [0.153, 0.271, 0.259]  // seafoam-700
                    },
                    olive: {
                        color1: [0.525, 0.620, 0.337], // olive-400
                        color2: [0.659, 0.737, 0.510], // olive-300
                        color3: [0.239, 0.282, 0.153]  // olive-700
                    },
                    wood: {
                        color1: [0.588, 0.447, 0.302], // wood-500
                        color2: [0.804, 0.686, 0.580], // wood-300
                        color3: [0.212, 0.161, 0.106]  // wood-800
                    },
                    parchment: {
                        color1: [0.710, 0.659, 0.600], // parchment-400
                        color2: [0.871, 0.847, 0.816], // parchment-200
                        color3: [0.361, 0.325, 0.278]  // parchment-700
                    }
                };

                this.harmonyLabels = {
                    sundial: 'Ashley Chen Torres',
                    plum: 'Classic Ash',
                    seafoam: 'Coach',
                    olive: 'bestie',
                    wood: 'spiritual',
                    parchment: 'psychodynamic'
                };

                this.personaShapes = {
                    sundial: 'diamond',
                    plum: 'star',
                    seafoam: 'circle',
                    olive: 'heart',
                    wood: 'triangle',
                    parchment: 'square'
                };

                this.init();
            }

            init() {
                this.setupWebGL();
                this.setupUI();
                this.syncPaletteTitle();
                this.generateAndCompileShader();
                this.resizeCanvas();
                this.render();
            }

            setupWebGL() {
                this.gl = this.canvas.getContext('webgl') || this.canvas.getContext('experimental-webgl');
                if (!this.gl) {
                    console.error('WebGL not supported');
                    return;
                }
            }

            resizeCanvas() {
                const container = this.canvas.parentElement;
                this.canvas.width = container.offsetWidth * window.devicePixelRatio;
                this.canvas.height = container.offsetHeight * window.devicePixelRatio;
                if (this.gl) {
                    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);
                }
            }

            setupUI() {
                const paletteTitle = document.getElementById('paletteTitle');
                const voicePaletteTitle = document.getElementById('voicePaletteTitle');
                const headerIcon = document.querySelector('#screen-chat .header-icon');
                const voiceHeaderIcon = document.getElementById('voiceHeaderIcon');
                const headerPill = document.querySelector('.header-pill');
                const headerIconButton = document.querySelector('#screen-chat .header-icon');
                const personaSheet = document.getElementById('personaSheet');
                const personaSheetOverlay = document.getElementById('personaSheetOverlay');
                const personaIcon = document.getElementById('personaIcon');
                const personaShape = document.getElementById('personaShape');
                const harmonyButtons = Array.from(document.querySelectorAll('.harmony-btn'));
                const presetButtons = Array.from(document.querySelectorAll('.preset-btn'));
                const personaButtons = Array.from(document.querySelectorAll('.persona-btn'));
                const voiceBtn = document.getElementById('voiceBtn');
                const voiceBackBtn = document.getElementById('voiceBackBtn');
                const voiceMicBtn = document.getElementById('voiceMicBtn');
                const voiceKeyboardBtn = document.getElementById('voiceKeyboardBtn');

                const setActiveButton = (buttons, predicate) => {
                    buttons.forEach(btn => {
                        btn.classList.toggle('active', predicate(btn));
                    });
                };

                const rgbToCss = (rgb) => {
                    const [r, g, b] = rgb.map(value => Math.round(value * 255));
                    return `rgb(${r}, ${g}, ${b})`;
                };

                const updatePaletteTitle = (harmony) => {
                    if (!paletteTitle) return;
                    paletteTitle.textContent = this.harmonyLabels[harmony] || harmony;
                    if (voicePaletteTitle) {
                        voicePaletteTitle.textContent = this.harmonyLabels[harmony] || harmony;
                    }
                };

                const updateIconGradient = (harmonyKey) => {
                    const harmony = this.harmonies[harmonyKey];
                    if (!harmony) return;
                    const applyStops = (icon) => {
                        if (!icon) return;
                        const stops = icon.querySelectorAll('stop');
                        if (stops.length >= 3) {
                            stops[0].setAttribute('stop-color', rgbToCss(harmony.color1));
                            stops[1].setAttribute('stop-color', rgbToCss(harmony.color2));
                            stops[2].setAttribute('stop-color', rgbToCss(harmony.color3));
                        }
                    };
                    applyStops(personaIcon);
                    applyStops(voiceHeaderIcon);

                    const [r, g, b] = harmony.color1.map(value => Math.round(value * 255));
                    [headerIcon, voiceHeaderIcon].forEach(icon => {
                        if (!icon) return;
                        icon.style.setProperty('--persona-accent-rgb', `${r}, ${g}, ${b}`);
                    });
                };

                const shapeMarkup = (shape) => {
                    switch (shape) {
                        case 'diamond':
                            return '<rect x="6" y="6" width="12" height="12" transform="rotate(45 12 12)"></rect>';
                        case 'circle':
                            return '<circle cx="12" cy="12" r="9"></circle>';
                        case 'heart':
                            return '<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>';
                        case 'triangle':
                            return '<polygon points="12,4 20,20 4,20"></polygon>';
                        case 'square':
                            return '<rect x="6" y="6" width="12" height="12" rx="2"></rect>';
                        default:
                            return '<path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>';
                    }
                };

                const updatePersonaIcon = () => {
                    const shapeNode = document.getElementById('personaShape');
                    const voiceShapeNode = document.getElementById('voicePersonaShape');
                    const harmonyKey = this.params.persona === 'pre' ? 'plum' : this.params.harmony;
                    const shape = this.params.persona === 'pre'
                        ? 'star'
                        : (this.personaShapes[harmonyKey] || 'star');
                    if (shapeNode) {
                        shapeNode.outerHTML = `
                            <g id="personaShape" fill="url(#personaGradient)">
                                ${shapeMarkup(shape)}
                            </g>
                        `;
                    }
                    if (voiceShapeNode) {
                        voiceShapeNode.outerHTML = `
                            <g id="voicePersonaShape" fill="url(#voicePersonaGradient)">
                                ${shapeMarkup(shape)}
                            </g>
                        `;
                    }
                    updateIconGradient(harmonyKey);
                };

                const setHarmony = (harmony, options = {}) => {
                    if (!this.harmonies[harmony]) return;
                    this.params.harmony = harmony;
                    updatePaletteTitle(harmony);
                    updateIconGradient(harmony);
                    updatePersonaIcon();
                    if (options.updateButtons !== false) {
                        setActiveButton(harmonyButtons, btn => btn.dataset.harmony === harmony);
                    }
                    if (this.updateShaderIntensity) {
                        this.updateShaderIntensity();
                    }
                };

                const setPreset = (preset) => {
                    this.params.preset = preset;
                    setActiveButton(presetButtons, btn => btn.dataset.preset === preset);
                    this.generateAndCompileShader();
                    if (this.updateShaderIntensity) {
                        this.updateShaderIntensity();
                    }
                };

                const lockHarmonyButtons = (isLocked) => {
                    harmonyButtons.forEach(btn => {
                        btn.classList.toggle('is-locked', isLocked);
                        btn.disabled = isLocked;
                    });
                };

                let lastPersona = this.params.persona;

                const setPersonaMode = (persona) => {
                    this.params.persona = persona;
                    setActiveButton(personaButtons, btn => btn.dataset.persona === persona);
                    const isPre = persona === 'pre';
                    if (isPre) {
                        setHarmony('plum');
                        lockHarmonyButtons(true);
                    } else {
                        lockHarmonyButtons(false);
                        if (lastPersona === 'pre') {
                            setHarmony('sundial');
                            setPreset('current');
                        }
                    }
                    updatePersonaIcon();
                    if (this.updateShaderIntensity) {
                        this.updateShaderIntensity();
                    }
                    lastPersona = persona;
                };

                // Preset buttons
                presetButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        setPreset(btn.dataset.preset);
                    });
                });

                // Step buttons
                document.querySelectorAll('.step-buttons').forEach(group => {
                    const control = group.dataset.control;
                    group.querySelectorAll('.step-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            group.querySelectorAll('.step-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            this.params[control] = parseInt(btn.dataset.value);
                        });
                    });
                });

                // Harmony buttons
                harmonyButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (btn.disabled) return;
                        setHarmony(btn.dataset.harmony);
                    });
                });

                // Persona buttons
                personaButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        setPersonaMode(btn.dataset.persona);
                    });
                });

                if (voiceBtn) {
                    voiceBtn.addEventListener('click', () => {
                        showScreen('voice');
                    });
                }

                if (voiceBackBtn) {
                    voiceBackBtn.addEventListener('click', () => {
                        showScreen('chat');
                    });
                }

                if (headerIconButton && personaSheet) {
                    const sheetPanel = personaSheet.querySelector('.persona-sheet-panel');
                    const personaOptions = Array.from(personaSheet.querySelectorAll('.persona-option'));
                    let isDragging = false;
                    let startY = 0;
                    let startTranslate = 0;
                    let currentTranslate = 0;

                    const getMaxTranslate = () => {
                        if (!sheetPanel) return 0;
                        return Math.max(0, sheetPanel.offsetHeight);
                    };

                    const applyTranslate = (value, withTransition = true) => {
                        if (!sheetPanel) return;
                        sheetPanel.style.transition = withTransition ? 'transform 0.35s ease' : 'none';
                        sheetPanel.style.setProperty('--sheet-translate', `${value}px`);
                        currentTranslate = value;
                    };

                    const openSheet = () => {
                        personaSheet.classList.add('open');
                        applyTranslate(getMaxTranslate(), false);
                        requestAnimationFrame(() => {
                            applyTranslate(getMaxTranslate() * 0.5, true);
                        });
                    };

                    const closeSheet = () => {
                        personaSheet.classList.remove('open');
                        applyTranslate(getMaxTranslate(), true);
                    };

                    headerIconButton.addEventListener('click', openSheet);
                    if (personaSheetOverlay) {
                        personaSheetOverlay.addEventListener('click', closeSheet);
                    }

                    if (sheetPanel) {
                        sheetPanel.addEventListener('pointerdown', (event) => {
                            if (event.target.closest('.persona-option')) {
                                return;
                            }
                            isDragging = true;
                            startY = event.clientY;
                            startTranslate = currentTranslate;
                            sheetPanel.setPointerCapture(event.pointerId);
                            sheetPanel.style.transition = 'none';
                        });

                        sheetPanel.addEventListener('pointermove', (event) => {
                            if (!isDragging) return;
                            const delta = event.clientY - startY;
                            const maxTranslate = getMaxTranslate();
                            const nextTranslate = Math.min(maxTranslate, Math.max(0, startTranslate + delta));
                            applyTranslate(nextTranslate, false);
                        });

                        const finishDrag = () => {
                            if (!isDragging) return;
                            isDragging = false;
                            const maxTranslate = getMaxTranslate();
                            if (currentTranslate > maxTranslate * 0.85) {
                                closeSheet();
                                return;
                            }
                            const snapPoint = currentTranslate < maxTranslate * 0.3
                                ? 0
                                : (currentTranslate < maxTranslate * 0.7 ? maxTranslate * 0.5 : maxTranslate);
                            applyTranslate(snapPoint, true);
                        };

                        sheetPanel.addEventListener('pointerup', finishDrag);
                        sheetPanel.addEventListener('pointercancel', finishDrag);
                    }

                    const personaDisplayLabels = {
                        plum: 'Classic Ash',
                        sundial: 'Ashley Chen Torres',
                        seafoam: 'Coach',
                        olive: 'Bestie',
                        wood: 'Spiritual',
                        parchment: 'Psychodynamic'
                    };

                    personaOptions.forEach(option => {
                        option.addEventListener('click', () => {
                            const harmony = option.dataset.harmony;
                            if (!harmony) return;
                            setPersonaMode('post');
                            setHarmony(harmony);
                            const shape = this.personaShapes[harmony] || 'star';
                            const displayLabel = personaDisplayLabels[harmony] || (this.harmonyLabels[harmony] || harmony);
                            addAutoResponse(displayLabel, harmony, shape, 'selected');
                            const chatAreaEl = document.getElementById('chatArea');
                            if (chatAreaEl) {
                                chatAreaEl.scrollTop = chatAreaEl.scrollHeight;
                            }
                            setPreset('current');
                            closeSheet();
                        });
                        option.addEventListener('pointerdown', (event) => {
                            event.stopPropagation();
                        });
                    });
                }

                // Opacity slider
                const opacitySlider = document.getElementById('opacitySlider');
                const opacityValue = document.getElementById('opacityValue');
                const shaderContainer = document.getElementById('shaderContainer');
                const rootStyle = document.documentElement.style;

                const animateShaderOpacity = () => {
                    if (!shaderContainer) return;
                    const value = parseFloat(opacitySlider.value);
                    const baseOpacity = value / 100;
                    const targetOpacity = this.params.persona === 'pre' ? 0 : baseOpacity;
                    shaderContainer.style.opacity = 0;
                    requestAnimationFrame(() => {
                        shaderContainer.style.opacity = targetOpacity;
                    });
                };

                this.updateShaderIntensity = () => {
                    const value = parseFloat(opacitySlider.value);
                    opacityValue.textContent = value + '%';
                    animateShaderOpacity();

                    const strength = Math.max(0.4, 1 - (value / 100) * 0.6);
                    rootStyle.setProperty('--ui-overlay-strength', strength.toFixed(3));
                };

                opacitySlider.addEventListener('input', this.updateShaderIntensity);
                this.updateShaderIntensity();

                // Chat functionality
                const messageInput = document.getElementById('messageInput');
                const sendBtn = document.getElementById('sendBtn');
                const chatArea = document.getElementById('chatArea');
                let glowTimeout = null;

                const triggerHeaderGlow = (targetIcon) => {
                    const icon = targetIcon || headerIcon;
                    if (!icon) return;
                    icon.classList.add('is-lit');
                    if (glowTimeout) {
                        clearTimeout(glowTimeout);
                    }
                    glowTimeout = setTimeout(() => {
                        icon.classList.remove('is-lit');
                    }, 350);
                };

                const addAutoResponse = (label, harmonyKey, shape, verb = 'recommended') => {
                    const iconSvg = `
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            ${shapeMarkup(shape)}
                        </svg>
                    `;
                    const responseDiv = document.createElement('div');
                    responseDiv.className = 'message-auto';
                    responseDiv.innerHTML = `
                        <span class="message-auto-icon">${iconSvg}</span>
                        <span class="message-auto-text">${label} ${verb}</span>
                    `;
                    chatArea.appendChild(responseDiv);
                };

                const handlePersonaTrigger = (text) => {
                    const normalized = text.toLowerCase().trim();
                    if (normalized === 'i want you to be nicer to me' || normalized === 'be nice to me' || normalized === 'you could be nicer to me') {
                        setPersonaMode('post');
                        setHarmony('sundial');
                        addAutoResponse('Ashley Chen Torres', 'sundial', 'star');
                        setPreset('current');
                        return true;
                    }
                    if (normalized === 'i want you to be straight forward') {
                        setPersonaMode('post');
                        setHarmony('seafoam');
                        addAutoResponse('Coach', 'seafoam', 'circle');
                        setPreset('current');
                        return true;
                    }

                    const keywordMap = [
                        { phrase: 'be nice to me', harmony: 'sundial', label: 'Ashley Chen Torres' },
                        { phrase: 'you could be nicer to me', harmony: 'sundial', label: 'Ashley Chen Torres' },
                        { phrase: 'bubbly', harmony: 'olive', label: 'Bestie' },
                        { phrase: 'motivate', harmony: 'seafoam', label: 'Coach' },
                        { phrase: 'straight forward', harmony: 'parchment', label: 'Psychodynamic' },
                        { phrase: 'nice', harmony: 'sundial', label: 'Ashley Chen Torres' },
                        { phrase: 'optimistic', harmony: 'wood', label: 'Spiritual' }
                    ];

                    const match = keywordMap.find(({ phrase }) => {
                        const escaped = phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`\\b${escaped}\\b`, 'i');
                        return regex.test(text);
                    });

                    if (match) {
                        setPersonaMode('post');
                        setHarmony(match.harmony);
                        const shape = this.personaShapes[match.harmony] || 'star';
                        addAutoResponse(match.label, match.harmony, shape);
                        setPreset('current');
                        return true;
                    }

                    return false;
                };

                const sendMessage = () => {
                    const text = messageInput.value.trim();
                    if (text) {
                        // Create user message bubble
                        const messageDiv = document.createElement('div');
                        messageDiv.className = 'message-user';
                        messageDiv.innerHTML = `
                            <div class="message-bubble">
                                <p>${text}</p>
                            </div>
                        `;
                        chatArea.appendChild(messageDiv);

                        // Clear input
                        messageInput.value = '';

                        const wasTriggered = handlePersonaTrigger(text);

                        if (this.updateShaderIntensity) {
                            this.updateShaderIntensity();
                        }

                        // Scroll to bottom
                        chatArea.scrollTop = chatArea.scrollHeight;
                    }
                };

                sendBtn.addEventListener('click', sendMessage);
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
                messageInput.addEventListener('input', () => {
                    triggerHeaderGlow();
                });

                const voiceStatus = document.querySelector('#screen-voice .voice-status');
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                let recognition = null;
                let isListening = false;
                let shouldAutoListen = false;
                let activeScreenId = 'chat';

                if (SpeechRecognition) {
                    recognition = new SpeechRecognition();
                    recognition.lang = 'en-US';
                    recognition.interimResults = true;
                    recognition.continuous = true;
                }

                const setVoiceStatus = (text) => {
                    if (voiceStatus) {
                        voiceStatus.textContent = text;
                    }
                };

                const setVoiceGlow = (isActive) => {
                    if (!voiceHeaderIcon) return;
                    voiceHeaderIcon.classList.toggle('is-lit', isActive);
                };

                const voiceStatusOnText = 'ASH IS LISTENING';
                const voiceStatusOffText = 'TALK TO ASH';
                let lastSpeechCommandAt = 0;
                let lastSpeechCommandText = '';

                const startListening = () => {
                    if (!recognition || isListening) return;
                    try {
                        shouldAutoListen = true;
                        isListening = true;
                        setVoiceStatus(voiceStatusOnText);
                        setVoiceGlow(false);
                        recognition.start();
                    } catch (error) {
                        isListening = false;
                        setVoiceStatus(voiceStatusOffText);
                        setVoiceGlow(false);
                    }
                };

                const stopListening = () => {
                    if (!recognition || !isListening) return;
                    shouldAutoListen = false;
                    recognition.stop();
                    setVoiceGlow(false);
                    setVoiceStatus(voiceStatusOffText);
                };

                const showScreen = (screenId) => {
                    activeScreenId = screenId;
                    document.querySelectorAll('.app-screen').forEach(s => s.classList.remove('active'));
                    const target = document.getElementById('screen-' + screenId);
                    if (target) {
                        target.classList.add('active');
                    }
                    if (screenId === 'voice') {
                        startListening();
                    } else {
                        stopListening();
                    }
                };

                if (recognition) {
                    recognition.addEventListener('speechstart', () => {
                        setVoiceGlow(true);
                    });

                    recognition.addEventListener('speechend', () => {
                        setVoiceGlow(false);
                    });

                    recognition.addEventListener('result', (event) => {
                        const results = Array.from(event.results);
                        const transcript = results
                            .map(result => result[0]?.transcript || '')
                            .join(' ')
                            .trim();
                        if (!transcript) return;

                        const latest = results[results.length - 1];
                        const latestText = (latest && latest[0]?.transcript ? latest[0].transcript : '').trim();
                        const lowerTranscript = transcript.toLowerCase();
                        const lowerLatest = latestText.toLowerCase();
                        const now = Date.now();
                        const hasNice = /\bnice\b/i.test(lowerTranscript) || /\bnice\b/i.test(lowerLatest);

                        if (hasNice && (now - lastSpeechCommandAt > 1500 || lastSpeechCommandText !== 'nice')) {
                            lastSpeechCommandAt = now;
                            lastSpeechCommandText = 'nice';
                            handlePersonaTrigger('nice');
                            return;
                        }

                        if (latest?.isFinal) {
                            handlePersonaTrigger(transcript);
                        }
                    });

                    recognition.addEventListener('end', () => {
                        isListening = false;
                        setVoiceStatus(voiceStatusOnText);
                        setVoiceGlow(false);
                        if (shouldAutoListen && activeScreenId === 'voice') {
                            setTimeout(() => {
                                startListening();
                            }, 250);
                        }
                    });

                    recognition.addEventListener('error', () => {
                        isListening = false;
                        setVoiceStatus(voiceStatusOffText);
                        setVoiceGlow(false);
                    });
                } else {
                    setVoiceStatus(voiceStatusOffText);
                }

                if (voiceMicBtn) {
                    voiceMicBtn.addEventListener('click', () => {
                        if (!recognition) return;
                        if (isListening) {
                            stopListening();
                        } else {
                            startListening();
                        }
                    });
                }

                if (voiceKeyboardBtn) {
                    voiceKeyboardBtn.addEventListener('click', () => {
                        showScreen('chat');
                    });
                }

                setPersonaMode(this.params.persona);
            }

            syncPaletteTitle() {
                const paletteTitle = document.getElementById('paletteTitle');
                if (!paletteTitle) return;

                paletteTitle.textContent = this.harmonyLabels[this.params.harmony] || this.params.harmony;
            }

            generateShaderCode() {
                const p = this.params;
                const speed = 0.5;
                const complexity = 1.2; // Fixed medium complexity
                const intensity = 1.0;

                let shaderEffectCode = '';

                switch (p.preset) {
                    case 'ripples':
                        shaderEffectCode = `
    vec2 p = uv;
    float dist = length(p);
    float ripple1 = sin(dist * 12.0 * complexity - t * speed * 2.0) * 0.5 + 0.5;
    float ripple2 = sin(dist * 8.0 * complexity - t * speed * 1.5 + 1.0) * 0.5 + 0.5;
    float ripple3 = sin(dist * 15.0 * complexity - t * speed * 2.5 + 2.0) * 0.5 + 0.5;
    float falloff = exp(-dist * (2.0 - intensity));
    float pattern = (ripple1 * 0.5 + ripple2 * 0.3 + ripple3 * 0.2) * falloff;
    vec3 col = mix(color1, color2, pattern);
    col = mix(col, color3, ripple1 * falloff);
                        `;
                        break;
                    case 'current':
                        shaderEffectCode = `
    vec2 p = uv;
    float current = sin(p.x * 4.0 * complexity - t * speed * 1.5);
    current += sin((p.x - p.y * 0.5) * 6.0 * complexity - t * speed * 2.0) * 0.5;
    current += cos(p.x * 3.0 * complexity + p.y * 2.0 - t * speed) * 0.3;
    float depthGrad = (p.y + 1.0) * 0.5;
    depthGrad = pow(depthGrad, 1.5 - intensity * 0.5);
    float pattern = (current * 0.4 + 0.5) * depthGrad;
    vec3 col = mix(color2, color1, pattern);
    col = mix(col, color3, sin(pattern * 3.14159 + t * speed * 0.5) * 0.5 + 0.5);
                        `;
                        break;
                    case 'deep':
                        shaderEffectCode = `
    vec2 p = uv;
    float dist = length(p);
    float layer1 = sin(p.y * 5.0 * complexity + t * speed * 0.3);
    float layer2 = sin(p.y * 8.0 * complexity + t * speed * 0.5 + 1.0);
    float layer3 = sin(p.y * 12.0 * complexity + t * speed * 0.7 + 2.0);
    float variation = sin(p.x * 3.0 + t * speed * 0.2) * 0.3;
    float pattern = (layer1 * 0.5 + layer2 * 0.3 + layer3 * 0.2 + variation);
    pattern = pattern * 0.5 + 0.5;
    pattern *= 1.0 - dist * (1.5 - intensity * 0.5);
    vec3 col = mix(color3, color2, pattern);
    col = mix(col, color1, layer1 * 0.3 + 0.4);
                        `;
                        break;
                    case 'surface':
                        shaderEffectCode = `
    vec2 p = uv;
    float scatter1 = sin(p.x * 10.0 * complexity + t * speed * 2.0);
    float scatter2 = sin(p.y * 8.0 * complexity - t * speed * 1.5);
    float scatter3 = sin((p.x + p.y) * 6.0 * complexity + t * speed * 1.8);
    float pattern = scatter1 * scatter2 * 0.5 + scatter3 * 0.3 + 0.5;
    pattern *= 1.0 + sin(t * speed * 0.5) * intensity * 0.3;
    float shimmer = sin(p.x * 20.0 + p.y * 15.0 + t * speed * 3.0) * 0.1;
    pattern += shimmer;
    vec3 col = mix(color1, color3, pattern * 0.8);
    col = mix(col, color2, scatter1 * 0.4 + 0.5);
                        `;
                        break;
                    case 'tide':
                        shaderEffectCode = `
    vec2 p = uv;
    float tide = sin(t * speed * 0.8) * intensity * 0.5;
    float wave1 = sin(p.x * 6.0 * complexity + t * speed * 1.2 + tide);
    float wave2 = sin(p.x * 4.0 * complexity - t * speed * 0.8 + tide * 1.5);
    float gradient = (p.y + 1.0 + tide * 0.3) * 0.5;
    float pattern = (wave1 * 0.6 + wave2 * 0.4) * 0.5 + 0.5;
    pattern *= gradient;
    vec3 col = mix(color2, color1, pattern);
    col = mix(col, color3, abs(sin(t * speed * 0.4)) * 0.6 + 0.2);
                        `;
                        break;
                    case 'reflect':
                        shaderEffectCode = `
    vec2 p = uv;
    float dist = length(p);
    float angle = atan(p.y, p.x);
    float reflect1 = sin(dist * 10.0 * complexity - t * speed) * cos(angle * 4.0);
    float reflect2 = cos(dist * 8.0 * complexity + t * speed * 0.7) * sin(angle * 6.0);
    float radial = exp(-dist * (2.0 - intensity * 0.5));
    float pattern = (reflect1 * 0.6 + reflect2 * 0.4) * 0.5 + 0.5;
    pattern *= radial;
    vec3 col = mix(color1, color2, pattern);
    col = mix(col, color3, reflect1 * radial * 0.5 + 0.5);
                        `;
                        break;
                }

                return `
precision mediump float;
uniform float iTime;
uniform vec2 iResolution;
uniform vec3 color1;
uniform vec3 color2;
uniform vec3 color3;

void main() {
    vec2 uv = (gl_FragCoord.xy * 2.0 - iResolution) / iResolution.y;
    float t = iTime;
    float speed = ${speed.toFixed(2)};
    float complexity = ${complexity.toFixed(2)};
    float intensity = ${intensity.toFixed(2)};

    ${shaderEffectCode}

    float dist = length(uv);
    col += vec3(0.1) / (dist * 3.0 + 1.0);
    col = clamp(col, 0.0, 1.0);
    gl_FragColor = vec4(col, 1.0);
}
                `;
            }

            generateAndCompileShader() {
                const fragmentShaderSource = this.generateShaderCode();
                const vertexShaderSource = `
                    attribute vec2 position;
                    void main() {
                        gl_Position = vec4(position, 0.0, 1.0);
                    }
                `;

                try {
                    const vertexShader = this.createShader(this.gl.VERTEX_SHADER, vertexShaderSource);
                    const fragmentShader = this.createShader(this.gl.FRAGMENT_SHADER, fragmentShaderSource);

                    const program = this.gl.createProgram();
                    this.gl.attachShader(program, vertexShader);
                    this.gl.attachShader(program, fragmentShader);
                    this.gl.linkProgram(program);

                    if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {
                        throw new Error('Program link error');
                    }

                    if (this.program) {
                        this.gl.deleteProgram(this.program);
                    }

                    this.program = program;
                    this.setupGeometry();
                } catch (error) {
                    console.error('Shader error:', error);
                }
            }

            createShader(type, source) {
                const shader = this.gl.createShader(type);
                this.gl.shaderSource(shader, source);
                this.gl.compileShader(shader);

                if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {
                    const info = this.gl.getShaderInfoLog(shader);
                    this.gl.deleteShader(shader);
                    throw new Error('Shader compilation error:\n' + info);
                }
                return shader;
            }

            setupGeometry() {
                const positions = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);
                const buffer = this.gl.createBuffer();
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer);
                this.gl.bufferData(this.gl.ARRAY_BUFFER, positions, this.gl.STATIC_DRAW);

                const positionLocation = this.gl.getAttribLocation(this.program, 'position');
                this.gl.enableVertexAttribArray(positionLocation);
                this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);
            }

            render() {
                if (!this.gl || !this.program) {
                    requestAnimationFrame(() => this.render());
                    return;
                }

                this.currentTime = (Date.now() - this.startTime) / 1000;

                this.gl.clearColor(0, 0, 0, 1);
                this.gl.clear(this.gl.COLOR_BUFFER_BIT);
                this.gl.useProgram(this.program);

                const timeLocation = this.gl.getUniformLocation(this.program, 'iTime');
                const resolutionLocation = this.gl.getUniformLocation(this.program, 'iResolution');

                if (timeLocation) this.gl.uniform1f(timeLocation, this.currentTime);
                if (resolutionLocation) this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height);

                const harmony = this.harmonies[this.params.harmony];
                this.setUniformVec3('color1', harmony.color1);
                this.setUniformVec3('color2', harmony.color2);
                this.setUniformVec3('color3', harmony.color3);

                this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);
                requestAnimationFrame(() => this.render());
            }

            setUniformVec3(name, rgb) {
                const location = this.gl.getUniformLocation(this.program, name);
                if (location) this.gl.uniform3f(location, rgb[0], rgb[1], rgb[2]);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            new PhoneShaderStudio();

            const updateMockupScale = () => {
                const container = document.querySelector('.mockup-container');
                if (!container) return;

                const availableHeight = Math.max(0, window.innerHeight - 48);
                const scale = Math.min(1, availableHeight / container.offsetHeight);
                document.documentElement.style.setProperty('--mockup-scale', scale.toFixed(3));
            };

            window.addEventListener('resize', updateMockupScale);
            updateMockupScale();
        });
    </script>
</body>
</html>
